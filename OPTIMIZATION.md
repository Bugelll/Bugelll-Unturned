# 项目优化说明

## 优化内容

### 1. Dockerfile 优化

#### ✅ 移除 EXPOSE 声明
- **原因**：端口映射应在 docker-compose.yml 中配置，Dockerfile 中的 EXPOSE 只是文档说明
- **好处**：更灵活，可以根据需要配置不同的端口映射

#### ✅ 添加 procps 包
- **原因**：healthcheck 需要 pgrep 命令
- **改进**：确保健康检查功能正常工作

#### ✅ 改进包安装验证
- 添加关键工具验证，确保安装成功
- 改进错误处理

#### ✅ 优化 SteamCMD 安装
- 添加安装验证步骤
- 确保 steamcmd.sh 有执行权限

#### ✅ 改进注释
- 添加更详细的中文注释
- 说明各个步骤的作用

### 2. docker-compose.yml 优化

#### ✅ 添加详细注释
- 解释每个配置项的作用
- 说明端口映射格式
- 添加环境变量说明

#### ✅ 添加 GAME_ID 环境变量
- 明确指定 Unturned App ID
- 便于配置管理

#### ✅ 改进格式
- 移除多余空行
- 统一缩进和格式

### 3. init.sh 优化

#### ✅ 改进日志输出
- 添加分隔线和标题
- 更清晰的日志格式
- 显示所有关键配置信息

#### ✅ 改进错误处理
- 添加目录创建验证
- 添加可执行文件存在性检查
- 更友好的错误提示

#### ✅ 改进启动参数
- 更清晰的参数构建逻辑
- 显示启动信息

#### ✅ 添加默认值
- 为环境变量添加默认值
- 提高脚本健壮性

## 使用建议

### 端口配置

在 `docker-compose.yml` 中，你可以根据需要修改端口映射：

```yaml
ports:
  - "34567:27015/udp"   # 宿主机端口:容器端口
  - "34568:27016/udp"
```

这样可以将容器内的 27015-27016 映射到宿主机的任意端口。

### 多服务器部署

如果需要部署多个服务器，可以：

1. 复制 docker-compose.yml 为 docker-compose.server1.yml
2. 修改服务名称和端口映射
3. 使用 `-f` 参数指定配置文件：

```bash
docker-compose -f docker-compose.server1.yml up -d
```

## 优化效果

1. **更灵活**：端口映射完全由 docker-compose.yml 控制
2. **更清晰**：详细的注释和日志输出
3. **更健壮**：改进的错误处理和验证
4. **更易维护**：统一的代码风格和格式

## 注意事项

- 确保数据目录权限为 1000:1000
- 端口映射格式：`宿主机端口:容器端口/协议`
- 容器内端口（27015-27016）是 Unturned 默认端口，通常不需要修改
- 宿主机端口可以根据需要自由配置

